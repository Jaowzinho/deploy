<!DOCTYPE html>
<html lang="pt">

<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Academia</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/login.css" />
  <link rel="stylesheet" href="css/carrossel.css" />
</head>

<body>
  <script src="carrossel.js"></script>

  <header class="header">
    <div class="logo-container">
      <img src="img/logo.png" alt="Logo da Empresa" class="logo" />
      <img src="icones/icone Perfil 100x100.png" alt="Perfil" class="logo button" id="perfilBtn" />
    </div>
  </header>

  <div class="overlay" id="overlay"></div>

  <div class="login-popup" id="loginPopup">
    <h2>LOGIN</h2>
    <form>
      <label for="Email">Email</label>
      <input type="email" id="Email" placeholder="Digite seu Email" required />

      <label for="password">Senha</label>
      <input type="password" id="password" placeholder="Digite sua senha" required />

      <a href="#" class="forgot-password">Esqueci senha</a>
      <button type="button" class="login-btn" id="loginBtn">Login</button>
    </form>
  </div>

  <div class="login-popup" id="verificacaoCodigoPopup">
    <p class="verificacao-titulo">Recuperar senha email</p>
    <h2 class="verificacao-subtitulo">Digite o Código</h2>
    <p class="verificacao-texto">Acabamos de enviar um código para seu e-mail</p>

    <div class="codigo-inputs">
      <input type="text" maxlength="1" class="codigo" />
      <input type="text" maxlength="1" class="codigo" />
      <input type="text" maxlength="1" class="codigo" />
      <input type="text" maxlength="1" class="codigo" />
    </div>

    <button type="button" class="btn-enviar-codigo" id="enviarCodigoBtnLogin">Enviar</button>
  </div>

  <div class="login-popup" id="verificacaoCodigoPopupSenha">
    <p class="verificacao-titulo">Recuperar senha email</p>
    <h2 class="verificacao-subtitulo">Digite o Código</h2>
    <p class="verificacao-texto">Acabamos de enviar um código para seu e-mail</p>

    <div class="codigo-inputs" id="codigo-inputs">
      <input type="text" maxlength="1" class="codigo" id="campo1" />
      <input type="text" maxlength="1" class="codigo" id="campo2" />
      <input type="text" maxlength="1" class="codigo" id="campo3" />
      <input type="text" maxlength="1" class="codigo" id="campo4" />
    </div>

    <button type="button" class="btn-enviar-codigo" id="enviarCodigoBtnSenha">Enviar</button>
  </div>

  <div class="login-popup" id="recuperarEmailPopup">
    <h2>Recuperar Senha</h2>
    <form>
      <label for="email-recuperacao">Digite seu e-mail</label>
      <input type="email" id="email-recuperacao" placeholder="Seu e-mail" required />
      <button type="button" class="login-btn" id="enviarEmailRecuperacaoBtn">Enviar</button>
    </form>
    <a href="#" id="voltarLoginDoEmail" class="register-link">Voltar ao login</a>
  </div>

  <div class="login-popup" id="changePasswordPopup">
    <h2>Recuperar senha</h2>
    <form>
      <label for="new-password">Nova Senha</label>
      <input type="password" id="new-password" placeholder="Digite sua nova senha" required />

      <label for="confirm-new-password">Confirmar Nova Senha</label>
      <input type="password" id="confirm-new-password" placeholder="Confirme sua nova senha" required />

      <button type="submit" class="login-btn">Alterar Senha</button>
    </form>
    <a href="#" id="showLoginFromChange" class="register-link">Voltar ao login</a>
  </div>

  <section class="banner">
    <img src="img/banner.png" alt="Treino na academia" />
  </section>

  <div class="carrosselUm">
    <div class="swiper swiper1">
      <div class="swiper-wrapper">
        <div class="swiper-slide"><img src="img/academia.jpeg" alt="Imagem 1" /></div>
        <div class="swiper-slide"><img src="img/academia2.jpeg" alt="Imagem 2" /></div>
        <div class="swiper-slide"><img src="img/academia3.jpeg" alt="Imagem 3" /></div>
        <div class="swiper-slide"><img src="img/academia4.jpeg" alt="Imagem 4" /></div>
        <div class="swiper-slide"><img src="img/academia5.jpeg" alt="Imagem 5" /></div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="swiper swiper2">
      <div class="swiper-wrapper">
        <div class="swiper-slide"><a href="loja.html"><img src="img/1.png" alt="Produto 1" />
            <h3 class="product-name">Loja</h3>
          </a></div>
        <div class="swiper-slide"><a href="personal.html"><img src="img/2.png" alt="Produto 2" />
            <h3 class="product-name">Personal</h3>
          </a></div>
        <div class="swiper-slide"><a href="ambiente.html"><img src="img/3.png" alt="Produto 3" />
            <h3 class="product-name">Sobre Nós</h3>
          </a></div>
        <div class="swiper-slide"><a href="suporte.html"><img src="img/4.png" alt="Produto 4" />
            <h3 class="product-name">Suporte</h3>
          </a></div>
      </div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
      <div class="swiper-pagination"></div>
    </div>
  </div>

  <section class="Planos">
    <section class="plans">
      <div class="plan-card">
        <h3>Matrícula</h3>
        <p>R$ 30,00</p>
        <div class="pricing-details">
          <p>1 Aula experimental gratuita</p>
          <p>Aceitamos GYMPASS básico</p>
          <p>Aceitamos TOTALPASS TP1+</p>
        </div>
        <div class="accepted-payment">
          <img src="icones/total pass.png" alt="Totalpass" />
        </div>
      </div>
      <div class="plan-card">
        <h3>Mensalidade</h3>
        <p>R$ 120,00</p>
        <p>Horários de segunda a sexta:</p>
        <p>06:15 - 07:15 | 07:15 - 08:15</p>
        <p>10:00 - 11:00 | 17:00 - 18:00</p>
        <p>18:00 - 19:00 | 19:00 - 20:00</p>
      </div>
    </section>
  </section>

  <div class="container d-flex flex-column align-items-center my-5" style="max-width: 500px">
    <p class="text-center mb-2">Endereço: R. José Pereira Bueno, 68 - Vila Franca</p>
    <div class="ratio ratio-16x9 w-100">
      <iframe
        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3311.7841925781413!2d-46.74759997464877!3d-23.637938761923976!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x94ce51588fb35d2d%3A0x16f446ee82f28df7!2sR.%20Jos%C3%A9%20Pereira%20Bueno%2C%2068%20-%20Vila%20Franca%2C%20S%C3%A3o%20Paulo%20-%20SP%2C%2005776-430!5e0!3m2!1spt-BR!2sbr!4v1741351578052!5m2!1spt-BR!2sbr"
        style="border: 0" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-top">
      <div class="footer-left">
        <div class="footer-social">
          <a href="https://api.whatsapp.com/message/7SFQMRX2M76KG1?autoload=1&app_absent=0"><img
              src="icones/icons8-whatsapp-50.png" alt="WhatsApp" /></a>
          <a href="https://www.instagram.com/equipesaudeemacao/"><img src="icones/icons8-instagram-50.png"
              alt="Instagram" /></a>
        </div>
      </div>
      <div class="footer-logo"><img src="img/logo1.png" alt="Logo2" /></div>
    </div>
    <div class="footer-bottom">
      <div class="footer-terms">
        <a href="TermosUso.html">Termos de Uso</a>
        <a href="PoliticaPrivacidade.html">Política de Privacidade</a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script src="js/carrossel.js"></script>


  <script>
    const overlay = document.getElementById("overlay");
    let isRecuperacaoSenha = false;

    document.getElementById("perfilBtn").addEventListener("click", () => {
      const token = sessionStorage.getItem('token');
      if (token) {
        const payload = parseJwt(token);
        if (payload.perfil === "ADMIN") {
          window.location.href = "PerfilAdm.html";
        } else {
          window.location.href = "perfil.html";
        }
      } else {
        document.getElementById("loginPopup").classList.add("active");
        overlay.classList.add("active");
      }
    });

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(
        atob(base64)
          .split('')
          .map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          })
          .join('')
      );
      return JSON.parse(jsonPayload);
    }

    document.querySelector(".forgot-password").addEventListener("click", () => {
      isRecuperacaoSenha = true;
      document.getElementById("loginPopup").classList.remove("active");
      document.getElementById("recuperarEmailPopup").classList.add("active");
      overlay.classList.add("active");
    });

    document.getElementById("loginBtn").addEventListener("click", async () => {
      const email = document.getElementById("Email").value.trim();
      const senha = document.getElementById("password").value;

      if (!email || !senha) {
        alert("Preencha todos os campos.");
        return;
      }

      try {
        const response = await fetch("https://saude-api-hwp6.onrender.com/api/auth/solicitar-token", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, senha })
        });
        const texto = await response.text();
        if (!response.ok) {
          alert("Erro: " + texto);
          return;
        }
        alert(texto);
        document.getElementById("loginPopup").classList.remove("active");
        document.getElementById("verificacaoCodigoPopup").classList.add("active");
        overlay.classList.add("active");
      } catch (err) {
        console.error("Erro na requisição:", err);
        alert("Erro ao conectar com o servidor.");
      }
    });

    document.getElementById("enviarEmailRecuperacaoBtn").addEventListener("click", async () => {
      const email = document.getElementById("email-recuperacao").value.trim();
      if (!email) {
        alert("Digite o e-mail para recuperação.");
        return;
      }
      try {
        const response = await fetch("https://saude-api-hwp6.onrender.com/api/auth/esqueci-senha/solicitar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email })
        });
        const texto = await response.text();
        if (!response.ok) {
          alert("Erro: " + texto);
          return;
        }
        alert(texto);
        document.getElementById("recuperarEmailPopup").classList.remove("active");
        document.getElementById("verificacaoCodigoPopupSenha").classList.add("active");
        overlay.classList.add("active");
      } catch (err) {
        console.error("Erro ao solicitar recuperação:", err);
        alert("Erro ao conectar com o servidor.");
      }
    });

    function parseJwt(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(
        atob(base64)
          .split('')
          .map(function (c) {
            return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
          })
          .join('')
      );
      return JSON.parse(jsonPayload);
    }

    document.getElementById("enviarCodigoBtnLogin").addEventListener("click", async () => {
      const inputsCodigo = document.querySelectorAll("#verificacaoCodigoPopup .codigo");
      let token = "";
      inputsCodigo.forEach(input => {
        token += input.value.trim();
      });
      if (!token) {
        alert("Digite o token.");
        return;
      }
      try {
        const response = await fetch("https://saude-api-hwp6.onrender.com/api/auth/login-token", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token })
        });
        const texto = await response.text();
        if (!response.ok) {
          alert("Erro: " + texto);
          return;
        }
        sessionStorage.setItem('token', texto);
        const payload = parseJwt(texto);
        if (payload.perfil === "ADMIN") {
          window.location.href = "PerfilAdm.html";
        } else {
          window.location.href = "perfil.html";
        }
      } catch (err) {
        console.error("Erro ao validar token de login:", err);
        alert("Erro ao validar o token.");
      }
    });

    document.getElementById("enviarCodigoBtnSenha").addEventListener("click", () => {
      const inputsCodigo = document.querySelectorAll("#verificacaoCodigoPopupSenha .codigo");
      let token = "";
      inputsCodigo.forEach(input => {
        token += input.value.trim();
      });
      if (!token) {
        alert("Digite o token.");
        return;
      }
      document.getElementById("verificacaoCodigoPopupSenha").classList.remove("active");
      document.getElementById("changePasswordPopup").classList.add("active");
      overlay.classList.add("active");
      window.tokenRecuperacaoSenha = token;
    });

    document.querySelector("#changePasswordPopup form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const novaSenha = document.getElementById("new-password").value;
      const confirmarSenha = document.getElementById("confirm-new-password").value;
      if (!novaSenha || !confirmarSenha) {
        alert("Preencha os dois campos de senha.");
        return;
      }
      if (novaSenha !== confirmarSenha) {
        alert("As senhas não coincidem.");
        return;
      }
      const token = window.tokenRecuperacaoSenha;
      if (!token) {
        alert("Token de recuperação não encontrado. Tente novamente.");
        return;
      }
      try {
        const response = await fetch("https://saude-api-hwp6.onrender.com/api/auth/esqueci-senha/confirmar", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token, novaSenha })
        });
        const texto = await response.text();
        if (!response.ok) {
          alert("Erro: " + texto);
          return;
        }
        alert(texto);
        document.getElementById("changePasswordPopup").classList.remove("active");
        overlay.classList.remove("active");
      } catch (err) {
        console.error("Erro ao redefinir senha:", err);
        alert("Erro ao conectar com o servidor.");
      }
    });

    overlay.addEventListener("click", () => {
      document.querySelectorAll(".login-popup").forEach(popup => popup.classList.remove("active"));
      overlay.classList.remove("active");
    });

    document.getElementById("showLoginFromChange").addEventListener("click", () => {
      document.getElementById("changePasswordPopup").classList.remove("active");
      document.getElementById("loginPopup").classList.add("active");
    });

    document.getElementById("voltarLoginDoEmail").addEventListener("click", () => {
      document.getElementById("recuperarEmailPopup").classList.remove("active");
      document.getElementById("loginPopup").classList.add("active");
    });
  </script>

  <script>
    const campos = document.querySelectorAll('.codigo');
    campos.forEach((campo, index) => {
      campo.addEventListener('input', () => {
        if (campo.value.length === 1 && index < campos.length - 1) {
          campos[index + 1].focus();
        }
      });
      campo.addEventListener('keydown', (e) => {
        if (e.key === 'Backspace' && campo.value === '' && index > 0) {
          campos[index - 1].focus();
        }
      });
    });
  </script>

</body>

</html>