<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de API</title>
    <script type="module" src="service/api.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste de API</h1>
    
    <div class="test-section">
        <h3>üîó Teste de Conectividade</h3>
        <button class="test-button" onclick="testConnectivity()">Testar Conex√£o com APIs</button>
        <div id="connectivity-result"></div>
    </div>

    <div class="test-section">
        <h3>üîê Teste de Login</h3>
        <input type="email" id="test-email" placeholder="Email de teste" value="teste@exemplo.com">
        <input type="password" id="test-password" placeholder="Senha de teste" value="123456">
        <button class="test-button" onclick="testLogin()">Testar Login</button>
        <div id="login-result"></div>
    </div>

    <div class="test-section">
        <h3>üìß Teste de Recupera√ß√£o de Senha</h3>
        <input type="email" id="reset-email" placeholder="Email para recupera√ß√£o" value="teste@exemplo.com">
        <button class="test-button" onclick="testPasswordReset()">Testar Recupera√ß√£o</button>
        <div id="reset-result"></div>
    </div>

    <div class="test-section">
        <h3>üìã Logs de Console</h3>
        <button class="test-button" onclick="clearLogs()">Limpar Logs</button>
        <div id="console-logs" class="result info"></div>
    </div>

    <script type="module">
        import api from './service/api.js';

        // Fun√ß√£o para mostrar resultados
        function showResult(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `result ${type}`;
        }

        // Fun√ß√£o para capturar logs do console
        const originalLog = console.log;
        const originalError = console.error;
        const logsDiv = document.getElementById('console-logs');

        function updateLogs() {
            logsDiv.textContent = 'Logs aparecer√£o aqui quando voc√™ fizer os testes...';
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            logsDiv.textContent += args.join(' ') + '\n';
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            logsDiv.textContent += '‚ùå ' + args.join(' ') + '\n';
        };

        // Teste de conectividade
        window.testConnectivity = async function() {
            showResult('connectivity-result', 'üîÑ Testando conectividade...', 'info');
            
            try {
                // Teste da API Saude
                const saudeResponse = await fetch('https://saude-api-hwp6.onrender.com', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                // Teste da API Admin
                const adminResponse = await fetch('https://api-admin-8p0v.onrender.com', {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                let result = 'üìä Resultados dos testes:\n\n';
                result += `üè• API Saude (${saudeResponse.status}): ${saudeResponse.ok ? '‚úÖ Online' : '‚ùå Erro'}\n`;
                result += `üë®‚Äçüíº API Admin (${adminResponse.status}): ${adminResponse.ok ? '‚úÖ Online' : '‚ùå Erro'}\n\n`;
                
                if (saudeResponse.ok) {
                    const saudeData = await saudeResponse.text();
                    result += `üì• Resposta Saude: ${saudeData}\n`;
                }
                
                if (adminResponse.ok) {
                    const adminData = await adminResponse.text();
                    result += `üì• Resposta Admin: ${adminData}\n`;
                }

                showResult('connectivity-result', result, saudeResponse.ok && adminResponse.ok ? 'success' : 'error');
            } catch (error) {
                showResult('connectivity-result', `‚ùå Erro de conectividade: ${error.message}`, 'error');
            }
        };

        // Teste de login
        window.testLogin = async function() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            
            if (!email || !password) {
                showResult('login-result', '‚ùå Por favor, preencha email e senha', 'error');
                return;
            }

            showResult('login-result', 'üîÑ Testando login...', 'info');
            
            try {
                const response = await api.saude.login({ email, password });
                showResult('login-result', `‚úÖ Login bem-sucedido!\nüì• Resposta: ${JSON.stringify(response, null, 2)}`, 'success');
            } catch (error) {
                showResult('login-result', `‚ùå Erro no login: ${error.message}`, 'error');
            }
        };

        // Teste de recupera√ß√£o de senha
        window.testPasswordReset = async function() {
            const email = document.getElementById('reset-email').value;
            
            if (!email) {
                showResult('reset-result', '‚ùå Por favor, insira um email', 'error');
                return;
            }

            showResult('reset-result', 'üîÑ Testando recupera√ß√£o de senha...', 'info');
            
            try {
                await api.saude.requestPasswordReset(email);
                showResult('reset-result', '‚úÖ Solicita√ß√£o de recupera√ß√£o enviada com sucesso!', 'success');
            } catch (error) {
                showResult('reset-result', `‚ùå Erro na recupera√ß√£o: ${error.message}`, 'error');
            }
        };

        // Limpar logs
        window.clearLogs = function() {
            logsDiv.textContent = '';
        };

        // Inicializar
        updateLogs();
    </script>
</body>
</html> 